# data/stories.yml - VERSIÓN FINAL SIN CONFLICTOS
version: "3.1"

stories:

# ========== FLUJOS BÁSICOS ==========

# SALUDO BÁSICO
- story: saludo basico
  steps:
  - intent: greet
  - action: utter_greet

# PAPELETAS - Flujo directo con placa
- story: consulta papeletas directa
  steps:
  - intent: consultar_papeletas
    entities:
    - placa: "APS583"
  - slot_was_set:
    - placa: "APS583"
  - action: action_confirmar_placa
  - slot_was_set:
    - esperando_confirmacion: true
    - placa_detectada: "APS583"
  - intent: confirm_yes
  - action: action_procesar_confirmacion
  - action: action_consultar_papeletas

# PAPELETAS - Sin placa, pedir y confirmar
- story: consulta papeletas sin placa
  steps:
  - intent: consultar_papeletas
  - action: utter_ask_placa
  - intent: provide_placa
    entities:
    - placa: "ABC123"
  - slot_was_set:
    - placa: "ABC123"
  - action: action_confirmar_placa
  - slot_was_set:
    - esperando_confirmacion: true
    - placa_detectada: "ABC123"
  - intent: confirm_yes
  - action: action_procesar_confirmacion
  - action: action_consultar_papeletas

# PAGOS DIRECTOS
- story: consulta pagos directa
  steps:
  - intent: consultar_pagos
  - action: action_consultar_pagos

# IMPUESTOS - Con DNI
- story: consulta impuestos con DNI
  steps:
  - intent: consultar_impuestos
    entities:
    - dni: "12345678"
  - slot_was_set:
    - dni: "12345678"
  - action: action_consultar_impuestos

# IMPUESTOS - Sin DNI
- story: consulta impuestos sin DNI
  steps:
  - intent: consultar_impuestos
  - action: utter_ask_dni
  - intent: provide_dni
    entities:
    - dni: "87654321"
  - slot_was_set:
    - dni: "87654321"
  - action: action_consultar_impuestos

# ========== FLUJOS DE CONFIRMACIÓN ==========

# CONFIRMACIÓN EXITOSA COMPLETA
- story: confirmacion exitosa completa
  steps:
  - intent: consultar_papeletas
    entities:
    - placa: "ABC123"
  - action: action_confirmar_placa
  - slot_was_set:
    - esperando_confirmacion: true
    - placa_detectada: "ABC123"
  - intent: confirm_yes
  - action: action_procesar_confirmacion
  - slot_was_set:
    - placa_confirmada: true
    - esperando_confirmacion: false
  - action: action_consultar_papeletas

# CONFIRMACIÓN NEGATIVA Y CORRECCIÓN
- story: confirmacion negativa y correccion
  steps:
  - intent: consultar_papeletas
    entities:
    - placa: "AXC123"
  - action: action_confirmar_placa
  - slot_was_set:
    - esperando_confirmacion: true
    - placa_detectada: "AXC123"
  - intent: confirm_no
  - action: action_procesar_confirmacion
  - slot_was_set:
    - placa_confirmada: false
    - esperando_confirmacion: false
  - intent: provide_correction
    entities:
    - placa: "ABC123"
  - action: action_procesar_correccion
  - slot_was_set:
    - placa: "ABC123"
    - placa_detectada: "ABC123"
  - action: action_confirmar_placa
  - slot_was_set:
    - esperando_confirmacion: true
  - intent: confirm_yes
  - action: action_procesar_confirmacion
  - action: action_consultar_papeletas

# CORRECCIÓN DIRECTA
- story: correccion directa
  steps:
  - intent: consultar_papeletas
    entities:
    - placa: "AXC123"
  - action: action_confirmar_placa
  - slot_was_set:
    - esperando_confirmacion: true
    - placa_detectada: "AXC123"
  - intent: provide_correction
    entities:
    - placa: "ABC123"
  - action: action_procesar_correccion
  - slot_was_set:
    - placa: "ABC123"
    - placa_detectada: "ABC123"
  - action: action_confirmar_placa
  - slot_was_set:
    - esperando_confirmacion: true
  - intent: confirm_yes
  - action: action_procesar_confirmacion
  - action: action_consultar_papeletas

# ========== FLUJOS DE CAMBIO DE CONSULTA ==========

# CAMBIO DURANTE SOLICITUD DE PLACA
- story: cambio durante solicitud placa
  steps:
  - intent: consultar_papeletas
  - action: utter_ask_placa
  - intent: cambiar_consulta
  - action: action_cambiar_consulta

# CAMBIO DURANTE CONFIRMACIÓN
- story: cambio durante confirmacion
  steps:
  - intent: consultar_papeletas
    entities:
    - placa: "ABC123"
  - action: action_confirmar_placa
  - slot_was_set:
    - esperando_confirmacion: true
  - intent: cambiar_consulta
  - action: action_cambiar_consulta

# CAMBIO ESPECÍFICO A PAGOS
- story: cambio especifico a pagos
  steps:
  - intent: consultar_papeletas
  - action: utter_ask_placa
  - intent: consultar_pagos
  - action: action_consultar_pagos

# CAMBIO ESPECÍFICO A IMPUESTOS
- story: cambio especifico a impuestos
  steps:
  - intent: consultar_papeletas
  - action: utter_ask_placa
  - intent: consultar_impuestos
  - action: utter_ask_dni

# ========== FLUJOS DE FINALIZACIÓN ==========

# FINALIZACIÓN DESPUÉS DE CONSULTA
- story: finalizacion despues consulta
  steps:
  - intent: consultar_papeletas
    entities:
    - placa: "ABC123"
  - action: action_confirmar_placa
  - intent: confirm_yes
  - action: action_procesar_confirmacion
  - action: action_consultar_papeletas
  - intent: finalizar_chat
  - action: action_finalizar_chat

# FINALIZACIÓN DURANTE FLUJO
- story: finalizacion durante flujo
  steps:
  - intent: consultar_papeletas
  - action: utter_ask_placa
  - intent: finalizar_chat
  - action: action_finalizar_chat

# FINALIZACIÓN CON GOODBYE
- story: finalizacion con goodbye
  steps:
  - intent: goodbye
  - action: action_finalizar_chat

# ========== FLUJOS COMBINADOS ==========

# CONSULTA MÚLTIPLE
- story: consulta multiple
  steps:
  - intent: greet
  - action: utter_greet
  - intent: consultar_papeletas
    entities:
    - placa: "ABC123"
  - action: action_confirmar_placa
  - intent: confirm_yes
  - action: action_procesar_confirmacion
  - action: action_consultar_papeletas
  - intent: consultar_pagos
  - action: action_consultar_pagos
  - intent: finalizar_chat
  - action: action_finalizar_chat

# FLUJO CON MÚLTIPLES CORRECCIONES
- story: multiples correcciones
  steps:
  - intent: consultar_papeletas
    entities:
    - placa: "AXC123"
  - action: action_confirmar_placa
  - intent: confirm_no
  - action: action_procesar_confirmacion
  - intent: provide_correction
    entities:
    - placa: "BXC123"
  - action: action_procesar_correccion
  - action: action_confirmar_placa
  - intent: confirm_no
  - action: action_procesar_confirmacion
  - intent: provide_correction
    entities:
    - placa: "ABC123"
  - action: action_procesar_correccion
  - action: action_confirmar_placa
  - intent: confirm_yes
  - action: action_procesar_confirmacion
  - action: action_consultar_papeletas

# CAMBIO DE OPINIÓN MÚLTIPLE
- story: cambio opinion multiple
  steps:
  - intent: consultar_papeletas
  - action: utter_ask_placa
  - intent: consultar_pagos
  - action: action_consultar_pagos
  - intent: consultar_impuestos
  - action: utter_ask_dni
  - intent: provide_dni
    entities:
    - dni: "12345678"
  - action: action_consultar_impuestos
