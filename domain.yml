version: "3.1"

intents:
  # ========== GLOBAL (funcionan siempre) ==========
  - greet
  - goodbye
  - menu_principal

  # ========== GLOBAL - CONSULTAS RÃPIDAS ESPECÃFICAS ==========
  - consulta_rapida_papeletas_placa
  - consulta_rapida_papeletas_dni
  - consulta_rapida_papeletas_ruc
  - consulta_rapida_codigo_falta
  - consulta_rapida_impuestos_placa
  - consulta_rapida_impuestos_dni
  - consulta_rapida_impuestos_ruc
  - consulta_rapida_impuestos_codigo

  # ========== NAVEGACIÃ“N A CONTEXTOS ==========
  - ir_a_casilla_mtc          # OpciÃ³n 1
  - ir_a_pagos_linea          # OpciÃ³n 2
  - ir_a_papeletas            # OpciÃ³n 3
  - ir_a_impuestos            # OpciÃ³n 4
  - ir_a_retencion_captura    # OpciÃ³n 5
  - ir_a_actualizar_datos     # OpciÃ³n 6
  - ir_a_lugares_pagos        # OpciÃ³n 7
  - ir_a_servicios_virtuales  # OpciÃ³n 8

  # ========== CONTEXTO PAPELETAS - CONSULTAS ESPECÃFICAS ==========
  - papeletas_consultar_placa
  - papeletas_consultar_dni
  - papeletas_consultar_ruc
  - papeletas_consultar_codigo_falta
  - papeletas_consultar_generico
  - papeletas_registrar
  - papeletas_facilidades
  - papeletas_frecuentes

  # ========== CONTEXTO IMPUESTOS - CONSULTAS ESPECÃFICAS ==========
  - impuestos_consultar_placa
  - impuestos_consultar_dni
  - impuestos_consultar_ruc
  - impuestos_consultar_codigo
  - impuestos_consultar_generico
  - impuestos_cuadernillo
  - impuestos_cuadernillo_agencia_virtual
  - impuestos_declarar_liquide
  - impuestos_declarar_vehicular
  - impuestos_declarar_predial
  - impuestos_liquidar_alcabala
  - impuestos_fraccionar_deuda
  - impuestos_beneficios
  - impuestos_beneficios_pensionista
  - impuestos_beneficios_adulto_mayor

  # ========== CONTEXTO RETENCIÃ“N - SUB-OPCIONES ==========
  - retencion_embargo_cuentas
  - retencion_orden_captura
  - retencion_vehiculo_internado
  - retencion_suspender_cobranza
  - retencion_terceria_propiedad
  - retencion_remate_vehicular
  - retencion_consultar_placa

  # ========== INTENTS PARA ACTUALIZAR DATOS ==========
  - actualizar_nombre
  - actualizar_documento
  - datos_correctos
  - proporcionar_nombre
  - proporcionar_tipo_documento
  - proporcionar_numero_documento

  # ========== CONTEXTO LUGARES Y PAGOS - SUB-OPCIONES ==========
  - lugares_pagos_agencias_horarios
  - lugares_pagos_lugares_pago
  - lugares_pagos_formas_pago

  # ========== CONTEXTO SERVICIOS VIRTUALES - SUB-OPCIONES ==========
  - servicios_virtuales_mesa_partes
  - servicios_virtuales_agencia_virtual
  - servicios_virtuales_pitazo
  - servicios_virtuales_correo
  - servicios_virtuales_libro_reclamaciones
  - servicios_virtuales_cursos

  # ========== CONTEXTO OTROS TRÃMITES ==========
  - ir_a_otros_tramites
  - tramites_consultar_numero
  - tramites_requisitos_papeletas
  - tramites_requisitos_tributarios
  - tramites_constancias_no_adeudo
  # ========== TRÃMITES PAPELETAS ESPECÃFICOS ==========
  - tramites_recurso_reconsideracion
  - tramites_descargo_infracciones
  - tramites_apelacion_papeletas
  - tramites_prescripcion_papeletas
  - tramites_devolucion_papeletas
  - tramites_terceria_requisitos
  - tramites_suspension_requisitos
  # ========== TRÃMITES TRIBUTARIOS ESPECÃFICOS ==========
  - tramites_predial_requisitos
  - tramites_vehicular_requisitos
  - tramites_alcabala_requisitos
  - tramites_reclamacion_tributaria
  - tramites_prescripcion_tributaria
  - tramites_devolucion_tributaria
  - tramites_apelacion_tributaria
  - tramites_terceria_tributaria
  - tramites_suspension_tributaria

  # ========== CLARIFICACIÃ“N Y AMBIGÃœEDAD ==========
  - clarify_papeletas
  - clarify_impuestos
  - consulta_ambigua_documento

  # ========== NAVEGACIÃ“N y SOLICITAR ASESOR ==========
  - otra_consulta
  - solicitar_asesor

entities:
  - placa
  - dni
  - ruc
  - codigo_falta
  - codigo_contribuyente
  - numero_tramite

slots:
  # ========== SLOTS DE CONTEXTO ==========
  contexto_actual:
    type: categorical
    values:
      - papeletas
      - impuestos
      - retencion
      - actualizar
      - lugares_pagos
      - otros_tramites
      - servicios_virtuales
      - general
    influence_conversation: true
    mappings:
      - type: custom

  ultimo_proceso:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  esperando_clarificacion:
    type: bool
    influence_conversation: true
    mappings:
    - type: custom

  documento_pendiente:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

  tipo_documento_pendiente:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

  documento_consulta:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

  tipo_documento:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

  # ========== SOLO PARA LOGGING ==========
  ultimo_documento:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

  # ========== SLOTS PARA ACTUALIZAR DATOS ==========
  esperando_nuevo_nombre:
    type: bool
    influence_conversation: true
    mappings:
      - type: custom

  datos_actuales:
    type: any
    influence_conversation: false
    mappings:
      - type: custom

  esperando_tipo_documento:
    type: bool
    influence_conversation: true
    mappings:
      - type: custom

  esperando_numero_documento:
    type: bool
    influence_conversation: true
    mappings:
      - type: custom

  nuevo_tipo_documento:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  # ========== SLOT PARA SOLICITAR ASESOR ==========
  asesor_solicitado:
    type: bool
    influence_conversation: false
    mappings:
      - type: custom

  # ========== SLOT PARA CONTAR NÃšMERO DE FALLBACKS ==========
  fallback_count:
    type: float
    initial_value: 0
    influence_conversation: true
    mappings:
      - type: custom

responses:
  utter_greet:
  - text: |
      Puedo ayudarte con **consultas rÃ¡pidas**. Puedes escribir directamente, por ejemplo:
      
      
      â€¢ "Ver papeletas de mi placa ABC123" 
      â€¢ "Impuestos de mi placa ABC123" 
      â€¢ "Deuda tributaria de mi DNI 12345678" 
      
      O si prefieres explorar las opciones completas:
      
      ğŸ“‹ **OPCIONES PRINCIPALES:**
      ğŸ”¹ **Casilla MTC** - Registro obligatorio
      ğŸ”¹ **Pagos** - Pagar por internet  
      ğŸ”¹ **Papeletas** - Multas y consultas de papeletas
      ğŸ”¹ **Impuestos** - Deuda tributaria y declaraciones
      ğŸ”¹ **RetenciÃ³n y Captura** - Ã“rdenes de captura y medidas cautelares
      ğŸ”¹ **Actualizar Datos** - Actualizar mi informaciÃ³n
      ğŸ”¹ **Lugares y Pagos** - Oficinas, horarios y formas de pago
      ğŸ”¹ **Servicios Virtuales** - TrÃ¡mites y servicios online
      ğŸ”¹ **Otros TrÃ¡mites** - TrÃ¡mites administrativos y requisitos
      
      Â¿En quÃ© puedo ayudarte?

  utter_menu_principal:
  - text: |
      ğŸ“‹ **MENÃš PRINCIPAL SAT LIMA**

      â€¢ "Ver papeletas de mi placa ABC123"
      â€¢ "Impuestos de mi placa ABC123"
      â€¢ "Deuda tributaria de mi DNI 12345678" 


      ğŸ“‹ **OPCIONES PRINCIPALES:**
      ğŸ”¹ **Casilla MTC** - Registro obligatorio
      ğŸ”¹ **Pagos** - Pagar por internet
      ğŸ”¹ **Papeletas** - Multas y consultas de papeletas
      ğŸ”¹ **Impuestos** - Deuda tributaria y declaraciones
      ğŸ”¹ **RetenciÃ³n y Captura** - Ã“rdenes de captura y medidas cautelares
      ğŸ”¹ **Actualizar Datos** - Actualizar mi informaciÃ³n
      ğŸ”¹ **Lugares y Pagos** - Oficinas, horarios y formas de pago
      ğŸ”¹ **Servicios Virtuales** - TrÃ¡mites y servicios online
      ğŸ”¹ **Otros TrÃ¡mites** - TrÃ¡mites administrativos y requisitos

      Â¿En quÃ© puedo ayudarte?

  # ========== OPCIÃ“N 1: CASILLA MTC ==========
  utter_casilla_mtc:
  - text: |
      ğŸ“‹ **CASILLA ELECTRÃ“NICA MTC**

      Es **obligatorio** inscribirse para cualquier trÃ¡mite de trÃ¡nsito o transporte.

      ğŸ”— **RegÃ­strate aquÃ­:** https://casilla.mtc.gob.pe/#/registro

      â€¢ Base Legal: R. Directoral NÂ°023-2024-MTC/18

      **Â¿QuÃ© mÃ¡s necesitas?**
      â€¢ 'MenÃº principal' - Ver otras opciones
      â€¢ 'Finalizar chat'

  # ========== OPCIÃ“N 2: PAGOS ==========
  utter_pagos_linea:
  - text: |
      ğŸ’³ **PAGAR POR INTERNET**

      ğŸ”— **PÃ¡gina de pagos:** https://www.sat.gob.pe/pagosenlinea/

      ğŸ’¡ **Puedes pagar con:**
      â€¢ Tarjetas: Visa, Mastercard, American Express
      â€¢ Yape
      â€¢ Bancos: BCP, Interbank, BBVA, Scotiabank

      **Â¿QuÃ© mÃ¡s necesitas?**
      â€¢ 'MenÃº principal' - Otras opciones
      â€¢ 'Finalizar chat'

  # ========== OPCIÃ“N 3: PAPELETAS MENÃš ==========
  utter_papeletas_menu:
  - text: |
      ğŸš— **PAPELETAS - Â¿QuÃ© necesitas?**

      âš¡ **CONSULTA RÃPIDA AQUÃ:**
      Escribe directamente:
      â€¢ **Placa:** "Mi placa es ABC123" - para ver papeletas del vehÃ­culo
      â€¢ **DNI:** "Mi DNI es 12345678" o solo "87654321" - para consultar tus papeletas personales
      â€¢ **"Registrar papeleta"** - Si no aparece tu multa
      â€¢ **"Facilidades de pago"** - Pagar en cuotas

      Â¿QuÃ© necesitas?

  # ========== OPCIÃ“N 4: IMPUESTOS MENÃš ==========
  utter_impuestos_menu:
  - text: |
      ğŸ’° **IMPUESTOS - Â¿QuÃ© necesitas?**

      Escribe directamente:
      â€¢ **Placa:** "Impuestos de mi placa ABC123" - para ver deuda tributarias de la placa
      â€¢ **DNI:** "Deuda tributaria DNI 12345678" - para consultar deudas tributarias con tu DNI
      â€¢ **RUC:** "Impuestos de RUC 20123456789" - para deudas tributarias relacionadas a tu RUC 
      â€¢ **"Cuadernillo tributario"** - Ver tu cuadernillo
      â€¢ **"Declare y liquide"** - Declarar nuevos predios/vehÃ­culos
      â€¢ **"Fraccionar deuda"** - Pagar en cuotas
      â€¢ **"Beneficios"** - Descuentos especiales

      Â¿QuÃ© necesitas?

  # ========== OPCIÃ“N 5: RETENCIÃ“N Y CAPTURA MENÃš ==========
  utter_retencion_menu:
  - text: |
      ğŸš¨ **RETENCIÃ“N Y CAPTURA - Â¿QuÃ© necesitas?**

      ğŸ“‹ **OPCIONES DISPONIBLES:**
      â€¢ **"RetenciÃ³n bancaria"** - InformaciÃ³n sobre embargo de cuentas
      â€¢ **"Orden de captura"** - Consultar si tu vehÃ­culo tiene orden de captura
      â€¢ **"VehÃ­culo internado"** - Consultar si tu vehÃ­culo estÃ¡ internado
      â€¢ **"Suspender cobranza"** - InformaciÃ³n para solicitar suspensiÃ³n de cobranza coactiva
      â€¢ **"TercerÃ­a de propiedad"** - InformaciÃ³n del rrÃ¡mite de tercerÃ­a
      â€¢ **"Remate vehicular"** - InformaciÃ³n sobre remates

      ğŸ’¡ **Para consultar orden de captura:** Escribe "orden de captura" 

      Â¿QuÃ© opciÃ³n necesitas?

  # ========== PAPELETAS SUB-OPCIONES ==========
  utter_papeletas_registrar:
  - text: |
      ğŸ“ **REGISTRAR PAPELETA NO ENCONTRADA**

      Si tu papeleta no aparece en el sistema:

      ğŸ”— **RegÃ­strala aquÃ­:** https://www.sat.gob.pe/websitev8/Popupv2.aspx?t=9&v=%20

      **Â¿Algo mÃ¡s?**
      â€¢ 'MenÃº principal' - Otras opciones
      â€¢ 'Finalizar chat'

  utter_papeletas_facilidades:
  - text: |
      ğŸ’° **FACILIDADES DE PAGO**

      **Para pagar en cuotas:**
      ğŸ”— **Agencia Virtual SAT:** https://www.sat.gob.pe/websitev9/Servicios/AgenciaVirtual

      **Pasos:**
      1. RegÃ­strate en Agencia Virtual
      2. Ve a Facilidades de pago/ Compromiso de pago
      3. Selecciona tus papeletas para fraccionar

      âš ï¸ **Importante:** Primero inscrÃ­bete en Casilla MTC

      **Â¿Algo mÃ¡s?**
      â€¢ 'MenÃº principal' - Otras opciones
      â€¢ 'Finalizar chat'

  utter_papeletas_frecuentes:
  - text: |
      â“ **CONSULTAS FRECUENTES PAPELETAS**

      ğŸ“‹ **Enlaces informativos:**

      ğŸ•’ **Plazos y descuentos:**
      https://www.sat.gob.pe/WebSiteV8/Modulos/contenidos/mult_Papeletas_ti_rntv2.aspx

      ğŸ“· **Ver imagen de papeleta:**
      https://www.sat.gob.pe/WebSitev8/IncioOV2.aspx

      ğŸ’¡ **Para consultar cÃ³digos de infracciÃ³n:**
      Escribe: "Â¿QuÃ© significa C15?" o "CÃ³digo M08"

      **Â¿Algo mÃ¡s?**
      â€¢ 'MenÃº principal' - Otras opciones
      â€¢ 'Finalizar chat'

  # ========== OPCIÃ“N 7: LUGARES Y PAGOS MENÃš ==========
  utter_lugares_pagos_menu:
  - text: |
      ğŸ¢ **LUGARES Y PAGOS**

      ğŸ“‹ **Â¿QuÃ© informaciÃ³n necesitas?**
      â€¢ **"Agencias y horarios"** - Ubicaciones y horarios de oficinas SAT
      â€¢ **"Lugares de pago"** - DÃ³nde puedes pagar (bancos, online, oficinas)
      â€¢ **"Formas de pago"** - Opciones para pagar (online, facilidades, cuotas)

      Â¿QuÃ© opciÃ³n necesitas?

  # ========== OPCIÃ“N 8: SERVICIOS VIRTUALES ==========
  utter_servicios_virtuales_menu:
  - text: |
      ğŸ’» **SERVICIOS VIRTUALES**

      ğŸ“‹ **Â¿QuÃ© servicio virtual necesitas?**
      â€¢ **"Mesa de partes"** - Presentar trÃ¡mites administrativos online
      â€¢ **"Agencia Virtual"** - Acceso a servicios digitales SAT
      â€¢ **"SuscrÃ­bete a Pitazo"** - Recibir alertas de papeletas
      â€¢ **"EnvÃ­anos un correo"** - Contacto por email
      â€¢ **"Libro de reclamaciones"** - Presentar reclamos oficiales
      â€¢ **"Cursos SAT"** - Capacitaciones y certificaciones

      Â¿QuÃ© servicio necesitas, dime?

  # ========== OPCIÃ“N 9: OTROS TRÃMITES MENÃš ==========
  utter_otros_tramites_menu:
  - text: |
      ğŸ“‹ **OTROS TRÃMITES ADMINISTRATIVOS**

      ğŸ“ **OPCIONES DISPONIBLES:**
      â€¢ **"Consultar trÃ¡mite 12345678901234"** (14 dÃ­gitos)
      â€¢ **"Requisitos papeletas"** - TrÃ¡mites administrativos de papeletas
      â€¢ **"Requisitos tributarios"** - TrÃ¡mites administrativos de impuestos
      â€¢ **"Constancias no adeudo"** - Obtener constancias

      Â¿QuÃ© opciÃ³n necesitas?
      
  # ========== SUB-MENÃšS OTROS TRÃMITES ==========
  utter_tramites_requisitos_papeletas:
  - text: |
      ğŸ“‹ **REQUISITOS DE TRÃMITES - PAPELETAS**

      â€¢ **"Recurso reconsideraciÃ³n"** - Requisitos para recurso de reconsideraciÃ³n
      â€¢ **"Descarga infracciones"** - Procedimiento para descarga de infracciones
      â€¢ **"DevoluciÃ³n papeletas"** - Requisitos para devoluciÃ³n y/o compensaciÃ³n
      â€¢ **"PrescripciÃ³n papeletas"** - Requisitos para solicitud de prescripciÃ³n
      â€¢ **"ApelaciÃ³n papeletas"** - Requisitos para recurso de apelaciÃ³n
      â€¢ **"TercerÃ­a requisitos"** - Requisitos para tercerÃ­a de propiedad
      â€¢ **"SuspensiÃ³n requisitos"** - Requisitos para suspensiÃ³n de cobranza

      Â¿QuÃ© trÃ¡mite de papeletas necesitas?

  utter_tramites_requisitos_tributarios:
  - text: |
      ğŸ“‹ **REQUISITOS DE TRÃMITES - TRIBUTARIOS**

      â€¢ **"Predial requisitos"** - Requisitos para declaraciÃ³n de impuesto predial
      â€¢ **"Vehicular requisitos"** - Requisitos para declaraciÃ³n de impuesto vehicular
      â€¢ **"Alcabala requisitos"** - Requisitos para liquidaciÃ³n de alcabala
      â€¢ **"ReclamaciÃ³n tributaria"** - Requisitos para recurso de reclamaciÃ³n
      â€¢ **"PrescripciÃ³n tributaria"** - Requisitos para solicitud de prescripciÃ³n
      â€¢ **"DevoluciÃ³n tributaria"** - Requisitos para devoluciÃ³n y/o compensaciÃ³n
      â€¢ **"ApelaciÃ³n tributaria"** - Requisitos para recurso de apelaciÃ³n
      â€¢ **"TercerÃ­a tributaria"** - Requisitos para tercerÃ­a de propiedad
      â€¢ **"SuspensiÃ³n tributaria"** - Requisitos para suspensiÃ³n de cobranza

      Â¿QuÃ© trÃ¡mite tributario necesitas?

  # ========== NAVEGACIÃ“N GLOBAL ==========
  utter_otra_consulta:
  - text: |
      ğŸ”„ **NUEVA CONSULTA**

      **Â¿QuÃ© quieres consultar?**

      ğŸš— **Papeletas:** "Ver papeletas de mi placa ABC123"
      ğŸ’° **Impuestos:** "Impuestos de mi DNI 12345678"
      ğŸ’³ **Pagos:** "InformaciÃ³n de pagos"
      ğŸ“‹ **Casilla MTC:** "Necesito inscribirme"

      **O puedes decir:**
      â€¢ 'MenÃº principal' - Ver todas las opciones
      â€¢ 'Finalizar chat'

      Â¿QuÃ© necesitas?

actions:
  # ========== RESPONSES ESTÃTICAS ==========
  - utter_greet
  - utter_menu_principal
  - utter_casilla_mtc
  - utter_pagos_linea
  - utter_papeletas_menu
  - utter_impuestos_menu
  - utter_papeletas_registrar
  - utter_papeletas_facilidades
  - utter_papeletas_frecuentes
  - utter_otra_consulta

  # ========== CUSTOM ACTIONS ==========
  - action_consultar_papeletas
  - action_consultar_codigo_falta
  # ========== IMPUESTOS ACTIONS ==========
  - action_consultar_impuestos
  - action_cuadernillo_agencia_virtual
  - action_declaracion_impuesto_vehicular
  - action_liquidacion_alcabala
  - action_declaracion_impuesto_predial
  - action_fraccionar_deuda
  - action_beneficios_pensionista
  - action_beneficios_adulto_mayor
  - action_route_document_consultation
  # ========== RETENCIÃ“N ACTIONS ==========
  - action_consultar_orden_captura
  - action_retencion_embargo
  - action_retencion_vehiculo_internado
  - action_retencion_suspender_cobranza
  - action_retencion_terceria_propiedad
  - action_retencion_remate_vehicular
  # ========== ACTUALIZAR DATOS ACTIONS ==========
  - action_actualizar_datos
  - action_actualizar_nombre
  - action_procesar_nuevo_nombre
  - action_actualizar_documento
  - action_procesar_tipo_documento
  - action_procesar_numero_documento
  # ========== LUGARES Y PAGOS ACTIONS ==========
  - action_lugares_agencias_horarios
  - action_lugares_pago
  - action_lugares_formas_pago
  # ========== SERVICIOS VIRTUALES ACTIONS ==========
  - action_servicios_mesa_partes
  - action_servicios_agencia_virtual
  - action_servicios_pitazo
  - action_servicios_correo
  - action_servicios_libro_reclamaciones
  - action_servicios_cursos
  # ========== OTROS TRÃMITES ACTIONS ==========
  - utter_otros_tramites_menu
  - utter_tramites_requisitos_papeletas
  - utter_tramites_requisitos_tributarios
  - action_consultar_tramite
  - action_tramites_constancias_no_adeudo
  # ========== TRÃMITES PAPELETAS ESPECÃFICOS ==========
  - action_tramites_recurso_reconsideracion
  - action_tramites_descargo_infracciones
  - action_tramites_apelacion_papeletas
  - action_tramites_prescripcion_papeletas
  - action_tramites_devolucion_papeletas
  - action_tramites_terceria_requisitos
  - action_tramites_suspension_requisitos
  # ========== TRÃMITES TRIBUTARIOS ESPECÃFICOS ==========
  - action_tramites_predial_requisitos
  - action_tramites_vehicular_requisitos
  - action_tramites_alcabala_requisitos
  - action_tramites_reclamacion_tributaria
  - action_tramites_prescripcion_tributaria
  - action_tramites_devolucion_tributaria
  - action_tramites_apelacion_tributaria
  - action_tramites_terceria_tributaria
  - action_tramites_suspension_tributaria
  # ========== FINALIZAR CHAT Y SOLICITAR ASESOR==========
  - action_finalizar_chat
  - action_solicitar_asesor
  - action_smart_fallback
  - action_reset_fallback_count

session_config:
  session_expiration_time: 600
  carry_over_slots_to_new_session: false