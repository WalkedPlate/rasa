version: "3.1"

intents:
  # ========== INTENTS BÃSICOS ==========
  - greet
  - goodbye
  - finalizar_chat
  - confirm_yes
  - confirm_no

  # ========== OPCIONES PRINCIPALES SAT ==========
  # OpciÃ³n 1: CASILLA MTC
  - casilla_mtc

  # OpciÃ³n 2: PAGOS EN LÃNEA
  - pagos_linea

  # OpciÃ³n 3: PAPELETAS
  - papeletas                    # Entrada general a papeletas
  - consulta_pago               # A. Consulta y Paga
  - registrar_papeleta          # B. Registrar Papeleta
  - consultas_frecuentes        # C. Consultas Frecuentes

  # ========== SUB-OPCIONES PAPELETAS ==========
  # Para Consulta y Pago
  - consultar_deuda             # Consultar por DNI/Placa/RUC + API
  - facilidad_pago              # InformaciÃ³n sobre facilidades

  # Para Consultas Frecuentes
  - plazos_descuentos           # Enlaces informativos
  - responsable_multa           # Enlaces informativos
  - imagen_papeleta             # Enlaces informativos
  - codigo_infraccion           # Requiere cÃ³digo + API
  - consecuencias_no_pago       # InformaciÃ³n sobre no pagar

  # ========== INTENTS DE DATOS ==========
  - provide_placa
  - provide_dni
  - provide_ruc
  - provide_codigo_falta
  - cambiar_tipo_consulta
  - nueva_consulta
  - limpiar_contexto           # NUEVO: Para resetear cuando usuario cambia

entities:
  # Datos de identificaciÃ³n
  - placa
  - dni
  - ruc
  - codigo_falta

  # Tipos de consulta para papeletas
  - consulta_type
  - frecuentes_type

slots:
  # ========== SLOTS SIMPLIFICADOS - SOLO DATOS ==========
  documento_consulta:
    type: text
    influence_conversation: false    # âœ… NO influye - solo almacena
    mappings:
    - type: custom

  tipo_documento:
    type: text                       # "placa", "dni", "ruc"
    influence_conversation: true     # âœ… SÃ influye - determina flujo API
    mappings:
    - type: custom

  codigo_falta:
    type: text
    influence_conversation: false    # âœ… NO influye - solo almacena
    mappings:
    - type: from_entity
      entity: codigo_falta

  # ========== SLOTS DE CONTEXTO ESPECÃFICOS ==========
  confirmacion_pendiente:
    type: bool
    initial_value: false
    influence_conversation: true     # âœ… SÃ influye - estado de confirmaciÃ³n
    mappings:
    - type: custom

  opcion_actual:
    type: text                       # "papeletas", "pagos", "casilla", etc.
    influence_conversation: true     # âœ… SÃ influye - contexto general
    mappings:
    - type: custom

  # ========== ELIMINAR ESTOS SLOTS COMPLEJOS ==========
  # placa: ELIMINADO - ahora es documento_consulta
  # dni: ELIMINADO - ahora es documento_consulta
  # ruc: ELIMINADO - ahora es documento_consulta
  # esperando_confirmacion: ELIMINADO - ahora es confirmacion_pendiente
  # dato_detectado: ELIMINADO - ahora es tipo_documento
  # tipo_consulta_actual: ELIMINADO - ahora es opcion_actual

responses:
  # ========== RESPUESTAS BÃSICAS ==========
  utter_greet:
  - text: |
      Â¡Hola! Bienvenido al SAT de Lima ğŸ‘‹

      Puedo ayudarte con:

      ğŸš— **Consultar papeletas** - Dime tu placa, DNI o RUC
      ğŸ’³ **Pagos en lÃ­nea** - InformaciÃ³n para pagar por internet  
      ğŸ“‹ **Casilla MTC** - Registro obligatorio para trÃ¡mites
      â“ **Consultas frecuentes** - Plazos, cÃ³digos, descuentos

      Solo dime quÃ© necesitas en tus propias palabras. Por ejemplo:
      â€¢ 'Quiero ver las multas de mi carro ABC123'
      â€¢ 'CÃ³mo puedo pagar en lÃ­nea'
      â€¢ 'QuÃ© significa el cÃ³digo C15'

      Â¿En quÃ© te puedo ayudar?

  utter_goodbye:
  - text: |
      Â¡Gracias por usar el SAT de Lima! ğŸ‘‹
      
      Espero haber sido de ayuda. Puedes regresar cuando necesites consultando nuevamente.
      
      Â¡Que tengas un buen dÃ­a! ğŸ˜Š

  # ========== RESPUESTAS OPCIONES PRINCIPALES ==========
  utter_casilla_mtc:
  - text: |
      Para iniciar un procedimiento administrativo vinculado a trÃ¡nsito o transporte, es obligatorio inscribirse en la Casilla ElectrÃ³nica del MTC, asÃ­ recibirÃ¡s oportunamente nuestras comunicaciones.
      ğŸ“Œhttps://casilla.mtc.gob.pe/#/registro
      Base Legal: R. Directoral NÂ°023-2024-MTC/18

  utter_pagos_linea:
  - text: |
      Para pagos ingrese aquÃ­: 
      ğŸ“Œhttps://www.sat.gob.pe/pagosenlinea/

      Espero que la informaciÃ³n brindada le haya sido Ãºtil ğŸ¤—

  # ========== RESPUESTAS PAPELETAS ==========
  utter_papeletas_menu:
  - text: |
      Te ayudo con papeletas. Â¿QuÃ© necesitas hacer?

      ğŸ” **Consultar deuda** - Con placa, DNI o RUC
      ğŸ“ **Registrar papeleta** - Si no aparece en el sistema
      â“ **Consultas frecuentes** - Plazos, cÃ³digos, descuentos

      Puedes decirme algo como:
      â€¢ 'Ver multas de mi placa ABC123'
      â€¢ 'Registrar una papeleta'
      â€¢ 'InformaciÃ³n sobre plazos'

  utter_consulta_pago_menu:
  - text: |
      Para consultar tu deuda de papeletas puedo buscar por:

      ğŸš— **Placa del vehÃ­culo**
      ğŸ†” **Tu DNI** 
      ğŸ¢ **RUC de empresa**

      TambiÃ©n puedo informarte sobre **facilidades de pago**.

      Â¿QuÃ© opciÃ³n prefieres?

  utter_registrar_papeleta:
  - text: |
      Si no figura su papeleta ingrese a Registra y paga tu papeleta aquÃ­: 
      ğŸ“Œhttps://www.sat.gob.pe/websitev8/Popupv2.aspx?t=9&v=%20

  utter_facilidad_pago:
  - text: |
      Puede realizarlo por nuestra Agencia Virtual SAT, para registrarse ir al siguiente link:
      ğŸ“Œhttps://www.SAT.gob.pe/websitev9/Servicios/AgenciaVirtual

      Luego de registrarse ingrese en la opciÃ³n Facilidades de pago.

      Le sugerimos ingresar al siguiente enlace para que pueda guiarse del procedimiento de agencia virtual: 
      ğŸ“Œhttps://www.SAT.gob.pe/AgenciaVirtual/guiainteractiva/

      Para iniciar un procedimiento administrativo vinculado a trÃ¡nsito o transporte, es obligatorio inscribirse en la Casilla ElectrÃ³nica del MTC, asÃ­ recibirÃ¡s oportunamente nuestras comunicaciones.
      ğŸ“Œhttps://casilla.mtc.gob.pe/#/registro
      Base Legal: R. Directoral NÂ°023-2024-MTC/18

  # ========== RESPUESTAS CONSULTAS FRECUENTES ==========
  utter_consultas_frecuentes_menu:
  - text: |
      Â¿QuÃ© informaciÃ³n necesitas sobre papeletas?

      ğŸ“… **Plazos y descuentos** - InformaciÃ³n sobre fechas de pago
      ğŸ‘¤ **Responsable de multa** - QuiÃ©n debe pagar
      ğŸ“· **Imagen de papeleta** - Ver foto de la infracciÃ³n
      ğŸ”¢ **CÃ³digo de infracciÃ³n** - Consultar quÃ© significa un cÃ³digo
      âš ï¸ **Consecuencias de no pagar** - QuÃ© pasa si no pagas

      Â¿Sobre quÃ© quieres informaciÃ³n?

  utter_plazos_descuentos:
  - text: |
      Estimado ciudadano, puede verificar la informaciÃ³n en el siguiente enlace:
      ğŸ“Œhttps://www.sat.gob.pe/WebSiteV8/Modulos/contenidos/mult_Papeletas_ti_rntv2.aspx

  utter_responsable_multa:
  - text: |
      Estimado ciudadano, puede verificar la informaciÃ³n en el siguiente enlace:
      ğŸ“Œhttps://www.sat.gob.pe/WebSiteV8/Modulos/contenidos/mult_Papeletas_ti_rntv2.aspx

  utter_imagen_papeleta:
  - text: |
      Estimado ciudadano, para consultar su papeleta ingrese aquÃ­:
      ğŸ“Œhttps://www.sat.gob.pe/WebSitev8/IncioOV2.aspx

  utter_consecuencias_no_pago:
  - text: |
      Estimado ciudadano, si no paga su papeleta dentro de los plazos establecidos, perderÃ¡ el beneficio. 

      Puede verificar los descuentos en el siguiente link: 
      ğŸ“Œhttps://www.sat.gob.pe/websitev9/TributosMultas/Papeletas/InformacionCodigodeTransito, numeral 6.

  # ========== NUEVAS RESPUESTAS PARA CONFIRMACIÃ“N ==========
  utter_pedir_confirmacion_placa:
  - text: "DetectÃ© la placa **{documento_consulta}**. Â¿Es correcta?"

  utter_pedir_confirmacion_dni:
  - text: "DetectÃ© el DNI **{documento_consulta}**. Â¿Es correcto?"

  utter_pedir_confirmacion_ruc:
  - text: "DetectÃ© el RUC **{documento_consulta}**. Â¿Es correcto?"

  utter_pedir_confirmacion_codigo:
  - text: "DetectÃ© el cÃ³digo de falta **{codigo_falta}**. Â¿Es correcto?"

  utter_dato_invalido:
  - text: |
      âŒ El dato proporcionado no tiene un formato vÃ¡lido.
      
      Por favor verifica e intenta nuevamente.

  utter_limpiar_contexto:
  - text: |
      âœ¨ Listo, empezamos de nuevo.
      
      Â¿En quÃ© puedo ayudarte?

  # ========== RESPUESTAS DE ERROR ==========
  utter_default:
  - text: |
      No entendÃ­ completamente tu solicitud. Puedo ayudarte con:

      ğŸš— **Papeletas** - Consultas, registro, informaciÃ³n
      ğŸ’³ **Pagos en lÃ­nea** - Enlaces para pagar
      ğŸ“‹ **Casilla MTC** - InformaciÃ³n de registro

      Â¿PodrÃ­as ser mÃ¡s especÃ­fico? Por ejemplo:
      â€¢ 'Consultar papeletas de mi placa ABC123'
      â€¢ 'InformaciÃ³n de pagos'

actions:
  # ========== ACTIONS BÃSICAS ==========
  - utter_greet
  - utter_goodbye
  - utter_default

  # ========== ACTIONS OPCIONES PRINCIPALES ==========
  - utter_casilla_mtc
  - utter_pagos_linea

  # ========== ACTIONS PAPELETAS ==========
  - utter_papeletas_menu
  - utter_consulta_pago_menu
  - utter_registrar_papeleta
  - utter_facilidad_pago
  - utter_consultas_frecuentes_menu

  # ========== ACTIONS CONSULTAS FRECUENTES ==========
  - utter_plazos_descuentos
  - utter_responsable_multa
  - utter_imagen_papeleta
  - utter_consecuencias_no_pago

  # ========== NUEVOS ACTIONS SIMPLIFICADOS ==========
  - action_validar_documento      # Solo valida y pide confirmaciÃ³n
  - action_consultar_api         # Solo consulta API
  - action_validar_codigo        # Solo valida cÃ³digo
  - action_consultar_codigo_api  # Solo consulta cÃ³digo API
  - action_limpiar_contexto      # Solo limpia slots
  - action_finalizar_chat

  # ========== ACTIONS DE CONFIRMACIÃ“N ==========
  - utter_pedir_confirmacion_placa
  - utter_pedir_confirmacion_dni
  - utter_pedir_confirmacion_ruc
  - utter_pedir_confirmacion_codigo
  - utter_dato_invalido
  - utter_limpiar_contexto

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: false