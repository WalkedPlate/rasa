version: "3.1"

intents:
  - greet
  - goodbye
  - consultar_papeletas
  - consultar_pagos
  - consultar_impuestos
  - provide_placa
  - provide_dni
  - provide_codigo_contribuyente
  - confirm_yes
  - confirm_no
  - provide_correction
  - cambiar_consulta
  - finalizar_chat
  - continuar_sesion

entities:
  - placa
  - dni
  - codigo_contribuyente

slots:
  placa:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: placa
  
  dni:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: dni
      
  codigo_contribuyente:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: codigo_contribuyente

  placa_detectada:
    type: text
    influence_conversation: true
    mappings:
    - type: custom

  placa_confirmada:
    type: bool
    influence_conversation: true
    mappings:
    - type: custom

  consulta_anterior:
    type: text
    influence_conversation: true
    mappings:
    - type: custom

  esperando_confirmacion:
    type: bool
    influence_conversation: true
    mappings:
    - type: custom

responses:
  utter_greet:
  - text: |
      Â¡Bienvenido al SAT de Lima! ğŸ‘‹
      
      Soy tu asistente virtual inteligente. Puedo ayudarte con:
      
      ğŸš— **Consultar papeletas** (necesito tu placa)
      ğŸ’³ **Pagos en lÃ­nea** (papeletas e impuestos)
      ğŸ  **Consultar impuestos** (predial/vehicular)
      
      Solo dime quÃ© necesitas en lenguaje natural. Â¿En quÃ© puedo ayudarte?

  utter_ask_placa:
  - text: "Para consultar papeletas necesito el nÃºmero de placa de tu vehÃ­culo. ğŸš—\n\nğŸ“ **Formato:** ABC123, AB1234, U1A710, etc.\n\nÂ¿CuÃ¡l es tu placa?"

  utter_ask_dni:
  - text: "Para consultar impuestos necesito tu nÃºmero de DNI. ğŸ†”\n\nğŸ“ **Formato:** 8 dÃ­gitos\n\nÂ¿CuÃ¡l es tu DNI?"
  
  utter_ask_codigo_contribuyente:
  - text: "Por favor, proporciona tu cÃ³digo de contribuyente ğŸ“„"

  utter_goodbye:
  - text: "Â¡Gracias por usar el SAT de Lima! ğŸ‘‹\n\nTu conversaciÃ³n ha sido guardada. Puedes regresar cuando necesites ayuda escribiendo 'hola'.\n\nÂ¡Que tengas un buen dÃ­a! ğŸ˜Š"

  utter_timeout_warning:
  - text: "â° Tu sesiÃ³n expirarÃ¡ en 1 minuto por inactividad.\n\nEscribe cualquier cosa para continuar o 'finalizar' para cerrar la conversaciÃ³n."

  utter_timeout_final:
  - text: "â° Cerrando conversaciÃ³n por inactividad.\n\nÂ¡Gracias por usar el SAT de Lima! Escribe 'hola' cuando necesites ayuda nuevamente. ğŸ˜Š"

actions:
  - action_consultar_papeletas
  - action_consultar_pagos
  - action_consultar_impuestos
  - action_confirmar_placa
  - action_procesar_confirmacion
  - action_procesar_correccion
  - action_cambiar_consulta
  - action_finalizar_chat
  - action_check_timeout
  - action_manejar_timeout_warning
  - action_manejar_timeout_final

session_config:
  session_expiration_time: 5  # 5 minutos
  carry_over_slots_to_new_session: false
