version: "3.1"

intents:
  # ========== INTENTS BÁSICOS ==========
  - greet
  - goodbye
  - finalizar_chat
  - confirm_yes
  - confirm_no

  # ========== OPCIONES PRINCIPALES SAT ==========
  # Opción 1: CASILLA MTC
  - casilla_mtc

  # Opción 2: PAGOS EN LÍNEA
  - pagos_linea

  # Opción 3: PAPELETAS
  - papeletas                    # Entrada general a papeletas
  - consulta_pago               # A. Consulta y Paga
  - registrar_papeleta          # B. Registrar Papeleta
  - consultas_frecuentes        # C. Consultas Frecuentes

  # ========== SUB-OPCIONES PAPELETAS ==========
  # Para Consulta y Pago
  - consultar_deuda             # Consultar por DNI/Placa/RUC + API
  - facilidad_pago              # Información sobre facilidades

  # Para Consultas Frecuentes
  - plazos_descuentos           # Enlaces informativos
  - responsable_multa           # Enlaces informativos
  - imagen_papeleta             # Enlaces informativos
  - codigo_infraccion           # Requiere código + API
  - consecuencias_no_pago       # Información sobre no pagar

  # ========== INTENTS DE DATOS ==========
  - provide_placa
  - provide_dni
  - provide_ruc
  - provide_codigo_falta
  - cambiar_tipo_consulta
  - nueva_consulta
  - limpiar_contexto           # NUEVO: Para resetear cuando usuario cambia

entities:
  # Datos de identificación
  - placa
  - dni
  - ruc
  - codigo_falta

  # Tipos de consulta para papeletas
  - consulta_type
  - frecuentes_type

slots:
  # ========== SLOTS SIMPLIFICADOS - SOLO DATOS ==========
  documento_consulta:
    type: text
    influence_conversation: false    # ✅ NO influye - solo almacena
    mappings:
    - type: custom

  tipo_documento:
    type: text                       # "placa", "dni", "ruc"
    influence_conversation: true     # ✅ SÍ influye - determina flujo API
    mappings:
    - type: custom

  codigo_falta:
    type: text
    influence_conversation: false    # ✅ NO influye - solo almacena
    mappings:
    - type: from_entity
      entity: codigo_falta

  # ========== SLOTS DE CONTEXTO ESPECÍFICOS ==========
  confirmacion_pendiente:
    type: bool
    initial_value: false
    influence_conversation: true     # ✅ SÍ influye - estado de confirmación
    mappings:
    - type: custom

  opcion_actual:
    type: text                       # "papeletas", "pagos", "casilla", etc.
    influence_conversation: true     # ✅ SÍ influye - contexto general
    mappings:
    - type: custom

  # ========== ELIMINAR ESTOS SLOTS COMPLEJOS ==========
  # placa: ELIMINADO - ahora es documento_consulta
  # dni: ELIMINADO - ahora es documento_consulta
  # ruc: ELIMINADO - ahora es documento_consulta
  # esperando_confirmacion: ELIMINADO - ahora es confirmacion_pendiente
  # dato_detectado: ELIMINADO - ahora es tipo_documento
  # tipo_consulta_actual: ELIMINADO - ahora es opcion_actual

responses:
  # ========== RESPUESTAS BÁSICAS ==========
  utter_greet:
  - text: |
      ¡Hola! Bienvenido al SAT de Lima 👋

      Puedo ayudarte con:

      🚗 **Consultar papeletas** - Dime tu placa, DNI o RUC
      💳 **Pagos en línea** - Información para pagar por internet  
      📋 **Casilla MTC** - Registro obligatorio para trámites
      ❓ **Consultas frecuentes** - Plazos, códigos, descuentos

      Solo dime qué necesitas en tus propias palabras. Por ejemplo:
      • 'Quiero ver las multas de mi carro ABC123'
      • 'Cómo puedo pagar en línea'
      • 'Qué significa el código C15'

      ¿En qué te puedo ayudar?

  utter_goodbye:
  - text: |
      ¡Gracias por usar el SAT de Lima! 👋
      
      Espero haber sido de ayuda. Puedes regresar cuando necesites consultando nuevamente.
      
      ¡Que tengas un buen día! 😊

  # ========== RESPUESTAS OPCIONES PRINCIPALES ==========
  utter_casilla_mtc:
  - text: |
      Para iniciar un procedimiento administrativo vinculado a tránsito o transporte, es obligatorio inscribirse en la Casilla Electrónica del MTC, así recibirás oportunamente nuestras comunicaciones.
      📌https://casilla.mtc.gob.pe/#/registro
      Base Legal: R. Directoral N°023-2024-MTC/18

  utter_pagos_linea:
  - text: |
      Para pagos ingrese aquí: 
      📌https://www.sat.gob.pe/pagosenlinea/

      Espero que la información brindada le haya sido útil 🤗

  # ========== RESPUESTAS PAPELETAS ==========
  utter_papeletas_menu:
  - text: |
      Te ayudo con papeletas. ¿Qué necesitas hacer?

      🔍 **Consultar deuda** - Con placa, DNI o RUC
      📝 **Registrar papeleta** - Si no aparece en el sistema
      ❓ **Consultas frecuentes** - Plazos, códigos, descuentos

      Puedes decirme algo como:
      • 'Ver multas de mi placa ABC123'
      • 'Registrar una papeleta'
      • 'Información sobre plazos'

  utter_consulta_pago_menu:
  - text: |
      Para consultar tu deuda de papeletas puedo buscar por:

      🚗 **Placa del vehículo**
      🆔 **Tu DNI** 
      🏢 **RUC de empresa**

      También puedo informarte sobre **facilidades de pago**.

      ¿Qué opción prefieres?

  utter_registrar_papeleta:
  - text: |
      Si no figura su papeleta ingrese a Registra y paga tu papeleta aquí: 
      📌https://www.sat.gob.pe/websitev8/Popupv2.aspx?t=9&v=%20

  utter_facilidad_pago:
  - text: |
      Puede realizarlo por nuestra Agencia Virtual SAT, para registrarse ir al siguiente link:
      📌https://www.SAT.gob.pe/websitev9/Servicios/AgenciaVirtual

      Luego de registrarse ingrese en la opción Facilidades de pago.

      Le sugerimos ingresar al siguiente enlace para que pueda guiarse del procedimiento de agencia virtual: 
      📌https://www.SAT.gob.pe/AgenciaVirtual/guiainteractiva/

      Para iniciar un procedimiento administrativo vinculado a tránsito o transporte, es obligatorio inscribirse en la Casilla Electrónica del MTC, así recibirás oportunamente nuestras comunicaciones.
      📌https://casilla.mtc.gob.pe/#/registro
      Base Legal: R. Directoral N°023-2024-MTC/18

  # ========== RESPUESTAS CONSULTAS FRECUENTES ==========
  utter_consultas_frecuentes_menu:
  - text: |
      ¿Qué información necesitas sobre papeletas?

      📅 **Plazos y descuentos** - Información sobre fechas de pago
      👤 **Responsable de multa** - Quién debe pagar
      📷 **Imagen de papeleta** - Ver foto de la infracción
      🔢 **Código de infracción** - Consultar qué significa un código
      ⚠️ **Consecuencias de no pagar** - Qué pasa si no pagas

      ¿Sobre qué quieres información?

  utter_plazos_descuentos:
  - text: |
      Estimado ciudadano, puede verificar la información en el siguiente enlace:
      📌https://www.sat.gob.pe/WebSiteV8/Modulos/contenidos/mult_Papeletas_ti_rntv2.aspx

  utter_responsable_multa:
  - text: |
      Estimado ciudadano, puede verificar la información en el siguiente enlace:
      📌https://www.sat.gob.pe/WebSiteV8/Modulos/contenidos/mult_Papeletas_ti_rntv2.aspx

  utter_imagen_papeleta:
  - text: |
      Estimado ciudadano, para consultar su papeleta ingrese aquí:
      📌https://www.sat.gob.pe/WebSitev8/IncioOV2.aspx

  utter_consecuencias_no_pago:
  - text: |
      Estimado ciudadano, si no paga su papeleta dentro de los plazos establecidos, perderá el beneficio. 

      Puede verificar los descuentos en el siguiente link: 
      📌https://www.sat.gob.pe/websitev9/TributosMultas/Papeletas/InformacionCodigodeTransito, numeral 6.

  # ========== NUEVAS RESPUESTAS PARA CONFIRMACIÓN ==========
  utter_pedir_confirmacion_placa:
  - text: "Detecté la placa **{documento_consulta}**. ¿Es correcta?"

  utter_pedir_confirmacion_dni:
  - text: "Detecté el DNI **{documento_consulta}**. ¿Es correcto?"

  utter_pedir_confirmacion_ruc:
  - text: "Detecté el RUC **{documento_consulta}**. ¿Es correcto?"

  utter_pedir_confirmacion_codigo:
  - text: "Detecté el código de falta **{codigo_falta}**. ¿Es correcto?"

  utter_dato_invalido:
  - text: |
      ❌ El dato proporcionado no tiene un formato válido.
      
      Por favor verifica e intenta nuevamente.

  utter_limpiar_contexto:
  - text: |
      ✨ Listo, empezamos de nuevo.
      
      ¿En qué puedo ayudarte?

  # ========== RESPUESTAS DE ERROR ==========
  utter_default:
  - text: |
      No entendí completamente tu solicitud. Puedo ayudarte con:

      🚗 **Papeletas** - Consultas, registro, información
      💳 **Pagos en línea** - Enlaces para pagar
      📋 **Casilla MTC** - Información de registro

      ¿Podrías ser más específico? Por ejemplo:
      • 'Consultar papeletas de mi placa ABC123'
      • 'Información de pagos'

actions:
  # ========== ACTIONS BÁSICAS ==========
  - utter_greet
  - utter_goodbye
  - utter_default

  # ========== ACTIONS OPCIONES PRINCIPALES ==========
  - utter_casilla_mtc
  - utter_pagos_linea

  # ========== ACTIONS PAPELETAS ==========
  - utter_papeletas_menu
  - utter_consulta_pago_menu
  - utter_registrar_papeleta
  - utter_facilidad_pago
  - utter_consultas_frecuentes_menu

  # ========== ACTIONS CONSULTAS FRECUENTES ==========
  - utter_plazos_descuentos
  - utter_responsable_multa
  - utter_imagen_papeleta
  - utter_consecuencias_no_pago

  # ========== NUEVOS ACTIONS SIMPLIFICADOS ==========
  - action_validar_documento      # Solo valida y pide confirmación
  - action_consultar_api         # Solo consulta API
  - action_validar_codigo        # Solo valida código
  - action_consultar_codigo_api  # Solo consulta código API
  - action_limpiar_contexto      # Solo limpia slots
  - action_finalizar_chat

  # ========== ACTIONS DE CONFIRMACIÓN ==========
  - utter_pedir_confirmacion_placa
  - utter_pedir_confirmacion_dni
  - utter_pedir_confirmacion_ruc
  - utter_pedir_confirmacion_codigo
  - utter_dato_invalido
  - utter_limpiar_contexto

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: false