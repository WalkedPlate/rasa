version: "3.1"

intents:
  # ========== GLOBAL (funcionan siempre) ==========
  - greet
  - goodbye
  - menu_principal

  # ========== GLOBAL - CONSULTAS RÁPIDAS ESPECÍFICAS ==========
  - consulta_rapida_papeletas_placa
  - consulta_rapida_papeletas_dni
  - consulta_rapida_papeletas_ruc
  - consulta_rapida_codigo_falta
  - consulta_rapida_impuestos_placa
  - consulta_rapida_impuestos_dni
  - consulta_rapida_impuestos_ruc
  - consulta_rapida_impuestos_codigo

  # ========== NAVEGACIÓN A CONTEXTOS ==========
  - ir_a_casilla_mtc          # Opción 1
  - ir_a_pagos_linea          # Opción 2
  - ir_a_papeletas            # Opción 3
  - ir_a_impuestos            # Opción 4
  - ir_a_retencion_captura    # Opción 5
  - ir_a_actualizar_datos     # Opción 6
  - ir_a_lugares_pagos        # Opción 7
  - ir_a_servicios_virtuales  # Opción 8

  # ========== CONTEXTO PAPELETAS - CONSULTAS ESPECÍFICAS ==========
  - papeletas_consultar_placa
  - papeletas_consultar_dni
  - papeletas_consultar_ruc
  - papeletas_consultar_codigo_falta
  - papeletas_consultar_generico
  - papeletas_registrar
  - papeletas_facilidades
  - papeletas_frecuentes

  # ========== CONTEXTO IMPUESTOS - CONSULTAS ESPECÍFICAS ==========
  - impuestos_consultar_placa
  - impuestos_consultar_dni
  - impuestos_consultar_ruc
  - impuestos_consultar_codigo
  - impuestos_consultar_generico
  - impuestos_cuadernillo
  - impuestos_cuadernillo_agencia_virtual
  - impuestos_cuadernillo_predial
  - impuestos_cuadernillo_vehicular
  - impuestos_declarar_liquide
  - impuestos_declarar_vehicular
  - impuestos_declarar_predial
  - impuestos_liquidar_alcabala
  - impuestos_fraccionar_deuda
  - impuestos_beneficios
  - impuestos_beneficios_pensionista
  - impuestos_beneficios_adulto_mayor

  # ========== CONTEXTO RETENCIÓN - SUB-OPCIONES ==========
  - retencion_embargo_cuentas
  - retencion_orden_captura
  - retencion_vehiculo_internado
  - retencion_suspender_cobranza
  - retencion_terceria_propiedad
  - retencion_levantamiento
  - retencion_remate_vehicular
  - retencion_consultar_placa

  # ========== CONTEXTO LUGARES Y PAGOS - SUB-OPCIONES ==========
  - lugares_pagos_agencias_horarios
  - lugares_pagos_lugares_pago
  - lugares_pagos_formas_pago

  # ========== CONTEXTO SERVICIOS VIRTUALES - SUB-OPCIONES ==========
  - servicios_virtuales_mesa_partes
  - servicios_virtuales_agencia_virtual
  - servicios_virtuales_pitazo
  - servicios_virtuales_correo
  - servicios_virtuales_libro_reclamaciones
  - servicios_virtuales_cursos

  # ========== CONTEXTO OTROS TRÁMITES ==========
  - ir_a_otros_tramites
  - tramites_consultar_numero
  - tramites_requisitos_papeletas
  - tramites_requisitos_tributarios
  - tramites_impugnacion_papeletas
  - tramites_reclamo_tributario
  - tramites_constancias_no_adeudo
  # ========== TRÁMITES PAPELETAS ESPECÍFICOS ==========
  - tramites_recurso_reconsideracion
  - tramites_descarga_infracciones
  - tramites_apelacion_papeletas
  - tramites_prescripcion_papeletas
  - tramites_devolucion_papeletas
  - tramites_terceria_requisitos
  - tramites_suspension_requisitos
  # ========== TRÁMITES TRIBUTARIOS ESPECÍFICOS ==========
  - tramites_predial_requisitos
  - tramites_vehicular_requisitos
  - tramites_alcabala_requisitos
  - tramites_reclamacion_tributaria
  - tramites_prescripcion_tributaria
  - tramites_devolucion_tributaria
  - tramites_apelacion_tributaria
  - tramites_terceria_tributaria
  - tramites_suspension_tributaria

  # ========== CLARIFICACIÓN Y AMBIGÜEDAD ==========
  - clarify_papeletas
  - clarify_impuestos
  - consulta_ambigua_documento

  # ========== NAVEGACIÓN ==========
  - otra_consulta

entities:
  - placa
  - dni
  - ruc
  - codigo_falta
  - codigo_contribuyente
  - numero_tramite

slots:
  # ========== SLOTS DE CONTEXTO ==========
  contexto_actual:
    type: categorical
    values:
      - papeletas
      - impuestos
      - retencion
      - actualizar
      - lugares_pagos
      - otros_tramites
      - servicios_virtuales
      - general
    influence_conversation: true
    mappings:
      - type: custom

  ultimo_proceso:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  esperando_clarificacion:
    type: bool
    influence_conversation: true
    mappings:
    - type: custom

  documento_pendiente:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

  tipo_documento_pendiente:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

  documento_consulta:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

  tipo_documento:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

  # ========== SOLO PARA LOGGING ==========
  ultimo_documento:
    type: text
    influence_conversation: false
    mappings:
    - type: custom

responses:
  utter_greet:
  - text: |
      Puedo ayudarte con **consultas rápidas**. Puedes escribir directamente, por ejemplo:
      
      ⚡ **PAPELETAS:**
      • "Ver papeletas de mi placa ABC123" - para consultar las papeletas de una placa
      • "Consultar papeletas de mi DNI 12345678" - para consultar papeletas por DNI
      • "Papeletas del RUC 20123456789" - para consultar papeletas de una empresa
      • "¿Qué significa el código C15?" - para conocer el significado de códigos de infracción
      
      ⚡ **IMPUESTOS:**
      • "Impuestos de mi placa ABC123" - para consultar deuda tributaria de un vehículo
      • "Deuda tributaria DNI 12345678" - para consultar impuestos por DNI
      • "Código contribuyente 94539" - para consultar por código de contribuyente
      
      O si prefieres explorar las opciones completas:
      
      📋 **OPCIONES PRINCIPALES:**
      🔹 **Casilla MTC** - Registro obligatorio
      🔹 **Pagos** - Pagar por internet  
      🔹 **Papeletas** - Multas y consultas de tránsito
      🔹 **Impuestos** - Deuda tributaria y declaraciones
      🔹 **Retención y Captura** - Órdenes de captura y medidas cautelares
      🔹 **Actualizar Datos** - Actualizar mi información
      🔹 **Lugares y Pagos** - Oficinas, horarios y formas de pago
      🔹 **Servicios Virtuales** - Trámites y servicios online
      🔹 **Otros Trámites** - Trámites administrativos y requisitos
      
      ¿Qué necesitas?

  utter_menu_principal:
  - text: |
      📋 **MENÚ PRINCIPAL SAT LIMA**

      ⚡ **CONSULTAS RÁPIDAS:**
      **PAPELETAS:**
      • "Ver papeletas de mi placa ABC123"
      • "Consultar multas de mi DNI 12345678"
      • "¿Qué significa el código C15?"

      **IMPUESTOS:**
      • "Impuestos de mi placa ABC123"
      • "Deuda tributaria DNI 12345678"
      • "Código contribuyente 94539"

      📋 **OPCIONES PRINCIPALES:**
      🔹 **Casilla MTC** - Registro obligatorio
      🔹 **Pagos** - Pagar por internet
      🔹 **Papeletas** - Multas y consultas de tránsito
      🔹 **Impuestos** - Deuda tributaria y declaraciones
      🔹 **Retención y Captura** - Órdenes de captura y medidas cautelares
      🔹 **Actualizar Datos** - Actualizar mi información
      🔹 **Lugares y Pagos** - Oficinas, horarios y formas de pago
      🔹 **Servicios Virtuales** - Trámites y servicios online
      🔹 **Otros Trámites** - Trámites administrativos y requisitos

      ¿Qué necesitas?

  # ========== OPCIÓN 1: CASILLA MTC ==========
  utter_casilla_mtc:
  - text: |
      📋 **CASILLA ELECTRÓNICA MTC**

      Es **obligatorio** inscribirse para cualquier trámite de tránsito o transporte.

      🔗 **Regístrate aquí:** https://casilla.mtc.gob.pe/#/registro

      **¿Por qué es obligatorio?**
      • Para recibir notificaciones oficiales
      • Requisito para todos los trámites vehiculares
      • Base Legal: R. Directoral N°023-2024-MTC/18

      📝 **Ejemplos de lo que puedes decir después:**
      • "Ya me registré, ahora quiero ver mis papeletas"
      • "¿Cómo pago mis multas?"
      • "¿Qué otros trámites puedo hacer?"

      **¿Qué más necesitas?**
      • 'Papeletas' - Consultar multas
      • 'Impuestos' - Consultar deuda tributaria
      • 'Pagos' - Información de pagos
      • 'Menú principal' - Ver otras opciones

  # ========== OPCIÓN 2: PAGOS ==========
  utter_pagos_linea:
  - text: |
      💳 **PAGAR POR INTERNET**

      🔗 **Página de pagos:** https://www.sat.gob.pe/pagosenlinea/

      💡 **Puedes pagar con:**
      • Tarjetas: Visa, Mastercard, American Express
      • Yape
      • Bancos: BCP, Interbank, BBVA, Scotiabank

      📝 **Ejemplos de lo que puedes decir:**
      • "¿Puedo pagar en cuotas?"
      • "Quiero ver mis papeletas primero"
      • "Necesito consultar mis impuestos"
      • "¿Dónde están las oficinas?"
      • "Información sobre descuentos"

      **¿Qué más necesitas?**
      • 'Papeletas' - Consultar cuánto debes en multas
      • 'Impuestos' - Consultar deuda tributaria
      • 'Facilidades' - Pagar en cuotas
      • 'Menú principal' - Otras opciones

  # ========== OPCIÓN 3: PAPELETAS MENÚ ==========
  utter_papeletas_menu:
  - text: |
      🚗 **PAPELETAS - ¿Qué necesitas?**

      ⚡ **CONSULTA RÁPIDA AQUÍ:**
      Escribe directamente:
      • **Placa:** "Mi placa es ABC123" - para ver papeletas del vehículo
      • **DNI:** "Mi DNI es 12345678" o solo "87654321" - para consultar tus papeletas personales
      • **RUC:** "RUC 20123456789" - para papeletas de tu empresa
      • **Código:** "¿Qué significa G40?" o "Código G41" - para entender qué infracción cometiste

      📝 **OTRAS OPCIONES:**
      • **"Registrar papeleta"** - Si no aparece tu multa
      • **"Facilidades de pago"** - Pagar en cuotas
      • **"Consultas frecuentes"** - Plazos, descuentos, etc.

      💡 **También puedes preguntar:**
      • "¿Tengo multas pendientes?"
      • "No encuentro mi papeleta"
      • "Quiero pagar en cuotas"
      • "Información sobre descuentos"

      ¿Qué necesitas?

  # ========== OPCIÓN 4: IMPUESTOS MENÚ ==========
  utter_impuestos_menu:
  - text: |
      💰 **IMPUESTOS - ¿Qué necesitas?**

      ⚡ **CONSULTA RÁPIDA AQUÍ:**
      Escribe directamente:
      • **Placa:** "Impuestos de mi placa ABC123" - para ver deuda tributarias de la placa
      • **DNI:** "Deuda tributaria DNI 12345678" - para consultar deudas tributarias con tu DNI
      • **RUC:** "Impuestos RUC 20123456789" - para deudas tributarias relacionadas a tu RUC 
      • **Código contribuyente:** "Código 94539" - para consultar con tu código

      📝 **OTRAS OPCIONES:**
      • **"Cuadernillo tributario"** - Ver tu cuadernillo
      • **"Declare y liquide"** - Declarar nuevos predios/vehículos
      • **"Fraccionar deuda"** - Pagar en cuotas
      • **"Beneficios"** - Descuentos especiales

      💡 **También puedes preguntar:**
      • "¿Tengo deuda tributaria pendiente?"
      • "Quiero declarar mi casa nueva"
      • "Soy pensionista, ¿tengo descuentos?"
      • "Necesito mi cuadernillo predial"

      ¿Qué necesitas?

  utter_retencion_menu:
  - text: |
      🚨 **RETENCIÓN Y CAPTURA - ¿Qué necesitas?**

      📋 **OPCIONES DISPONIBLES:**
      • **"Retención bancaria"** - Información sobre embargo de cuentas
      • **"Orden de captura"** - Consultar si tu vehículo tiene orden de captura
      • **"Vehículo internado"** - Consultar si tu vehículo está internado
      • **"Suspender cobranza"** - Información para solicitar suspensión de cobranza coactiva
      • **"Tercería de propiedad"** - Información del rrámite de tercería
      • **"Levantamiento"** - Información para solicitar levantamiento de medida cautelar
      • **"Remate vehicular"** - Información sobre remates

      💡 **Para consultar orden de captura:** Escribe "orden de captura" y luego proporciona tu placa, por ejemplo:
      • "Consultar orden de captura de la placa ABC123"

      ¿Qué opción necesitas?

  # ========== PAPELETAS SUB-OPCIONES ==========
  utter_papeletas_registrar:
  - text: |
      📝 **REGISTRAR PAPELETA NO ENCONTRADA**

      Si tu papeleta no aparece en el sistema:

      🔗 **Regístrala aquí:** https://www.sat.gob.pe/websitev8/Popupv2.aspx?t=9&v=%20

      **¿Algo más?**
      • Dame tu placa/DNI/RUC para consultar otras papeletas
      • 'Menú principal' - Otras opciones
      • 'Papeletas' - Volver al menú de papeletas

  utter_papeletas_facilidades:
  - text: |
      💰 **FACILIDADES DE PAGO**

      **Para pagar en cuotas:**
      🔗 **Agencia Virtual SAT:** https://www.sat.gob.pe/websitev9/Servicios/AgenciaVirtual

      **Pasos:**
      1. Regístrate en Agencia Virtual
      2. Ve a 'Facilidades de pago'
      3. Selecciona tus papeletas para fraccionar

      ⚠️ **Importante:** Primero inscríbete en Casilla MTC

      **¿Algo más?**
      • Dame tu placa/DNI/RUC para consultar papeletas
      • 'Casilla MTC' - Información de registro
      • 'Menú principal' - Otras opciones

  utter_papeletas_frecuentes:
  - text: |
      ❓ **CONSULTAS FRECUENTES PAPELETAS**

      📋 **Enlaces informativos:**

      🕒 **Plazos y descuentos:**
      https://www.sat.gob.pe/WebSiteV8/Modulos/contenidos/mult_Papeletas_ti_rntv2.aspx

      📷 **Ver imagen de papeleta:**
      https://www.sat.gob.pe/WebSitev8/IncioOV2.aspx

      💡 **Para consultar códigos de infracción:**
      Escribe: "¿Qué significa C15?" o "Código M08"

      **¿Algo más?**
      • Dame tu placa/DNI/RUC para consultar papeletas
      • 'Menú principal' - Otras opciones

  # ========== OPCIÓN 7: LUGARES Y PAGOS MENÚ ==========
  utter_lugares_pagos_menu:
  - text: |
      🏢 **LUGARES Y PAGOS**

      📋 **¿Qué información necesitas?**
      • **"Agencias y horarios"** - Ubicaciones y horarios de oficinas SAT
      • **"Lugares de pago"** - Dónde puedes pagar (bancos, online, oficinas)
      • **"Formas de pago"** - Opciones para pagar (online, facilidades, cuotas)

      💡 **También puedes decir:**
      • "Dónde están las oficinas del SAT"
      • "Horarios de atención"
      • "Cómo pago mis multas"

      ¿Qué opción necesitas?

  # ========== OPCIÓN 8: SERVICIOS VIRTUALES ==========
  utter_servicios_virtuales_menu:
  - text: |
      💻 **SERVICIOS VIRTUALES**

      📋 **¿Qué servicio virtual necesitas?**
      • **"Mesa de partes"** - Presentar trámites administrativos online
      • **"Agencia Virtual"** - Acceso a servicios digitales SAT
      • **"Suscríbete a Pitazo"** - Recibir alertas de papeletas
      • **"Envíanos un correo"** - Contacto por email
      • **"Libro de reclamaciones"** - Presentar reclamos oficiales
      • **"Cursos SAT"** - Capacitaciones y certificaciones

      💡 **También puedes decir:**
      • "Mesa de partes digital"
      • "Registro agencia virtual"
      • "Alertas de papeletas"
      • "Contactar por correo"

      ¿Qué servicio necesitas, dime?

  # ========== OPCIÓN 9: OTROS TRÁMITES MENÚ ==========
  utter_otros_tramites_menu:
  - text: |
      📋 **OTROS TRÁMITES ADMINISTRATIVOS**

      ⚡ **CONSULTA RÁPIDA DE TRÁMITE:**
      • **"Consultar trámite 12345678901234"** - Estado de tu trámite (14 dígitos)

      📝 **OPCIONES DISPONIBLES:**
      • **"Consultar trámite"** - Estado de tu trámite por número
      • **"Requisitos papeletas"** - Trámites administrativos de papeletas
      • **"Requisitos tributarios"** - Trámites administrativos de impuestos
      • **"Impugnación papeletas"** - Impugnar una papeleta
      • **"Reclamo tributario"** - Reclamaciones tributarias
      • **"Constancias no adeudo"** - Obtener constancias

      💡 **También puedes decir:**
      • "Mi número de trámite es 12345678901234"
      • "Necesito requisitos para apelar"
      • "Quiero impugnar una papeleta"

      ¿Qué opción necesitas?
      
  # ========== SUB-MENÚS OTROS TRÁMITES ==========
  utter_tramites_requisitos_papeletas:
  - text: |
      📋 **REQUISITOS DE TRÁMITES - PAPELETAS**

      📝 **OPCIONES DISPONIBLES:**
      • **"Recurso reconsideración"** - Requisitos para recurso de reconsideración
      • **"Descarga infracciones"** - Procedimiento para descarga de infracciones
      • **"Devolución papeletas"** - Requisitos para devolución y/o compensación
      • **"Prescripción papeletas"** - Requisitos para solicitud de prescripción
      • **"Apelación papeletas"** - Requisitos para recurso de apelación
      • **"Tercería requisitos"** - Requisitos para tercería de propiedad
      • **"Suspensión requisitos"** - Requisitos para suspensión de cobranza

      💡 **También puedes decir:**
      • "Necesito requisitos para apelar"
      • "Quiero información de prescripción"
      • "Cómo hago una tercería"

      ¿Qué trámite de papeletas necesitas?

  utter_tramites_requisitos_tributarios:
  - text: |
      📋 **REQUISITOS DE TRÁMITES - TRIBUTARIOS**

      📝 **OPCIONES DISPONIBLES:**
      • **"Predial requisitos"** - Requisitos para declaración de impuesto predial
      • **"Vehicular requisitos"** - Requisitos para declaración de impuesto vehicular
      • **"Alcabala requisitos"** - Requisitos para liquidación de alcabala
      • **"Reclamación tributaria"** - Requisitos para recurso de reclamación
      • **"Prescripción tributaria"** - Requisitos para solicitud de prescripción
      • **"Devolución tributaria"** - Requisitos para devolución y/o compensación
      • **"Apelación tributaria"** - Requisitos para recurso de apelación
      • **"Tercería tributaria"** - Requisitos para tercería de propiedad
      • **"Suspensión tributaria"** - Requisitos para suspensión de cobranza

      💡 **También puedes decir:**
      • "Necesito declarar mi casa"
      • "Quiero reclamar un impuesto"
      • "Cómo solicito prescripción"

      ¿Qué trámite tributario necesitas?

  # ========== NAVEGACIÓN GLOBAL ==========
  utter_otra_consulta:
  - text: |
      🔄 **NUEVA CONSULTA**

      **¿Qué quieres consultar?**

      🚗 **Papeletas:** "Ver papeletas de mi placa ABC123"
      💰 **Impuestos:** "Impuestos de mi DNI 12345678"
      💳 **Pagos:** "Información de pagos"
      📋 **Casilla MTC:** "Necesito inscribirme"

      **O puedes decir:**
      • 'Menú principal' - Ver todas las opciones
      • "¿Qué significa C15?" - Consultar códigos

      ¿Qué necesitas?

  # ========== FALLBACK GLOBAL ==========
  utter_default:
  - text: |
      No entendí completamente tu mensaje.

      📋 **OPCIONES PRINCIPALES:**
      Escribe el nombre de la opción que necesitas:
      🔹 **Casilla MTC** - "Casilla MTC" o "Registro"
      🔹 **Pagos** - "Pagos" o "Cómo pago"  
      🔹 **Papeletas** - "Papeletas" o "Multas"
      🔹 **Impuestos** - "Impuestos" o "Deuda tributaria"
      🔹 **Retención** - "Retención" o "Orden de captura"
      🔹 **Actualizar datos** - "Actualizar datos"
      🔹 **Lugares y pagos** - "Oficinas" o "Lugares de pago"
      🔹 **Servicios virtuales** - "Servicios virtuales"
      🔹 **Otros trámites** - "Otros trámites"

      💡 **También puedes decir:** "Menú principal"

        ¿Qué necesitas?
actions:
  # ========== RESPONSES ESTÁTICAS ==========
  - utter_greet
  - utter_menu_principal
  - utter_casilla_mtc
  - utter_pagos_linea
  - utter_papeletas_menu
  - utter_impuestos_menu
  - utter_papeletas_registrar
  - utter_papeletas_facilidades
  - utter_papeletas_frecuentes
  - utter_otra_consulta
  - utter_default

  # ========== CUSTOM ACTIONS ==========
  - action_consultar_papeletas
  - action_consultar_codigo_falta
  # ========== IMPUESTOS ACTIONS ==========
  - action_consultar_impuestos
  - action_cuadernillo_agencia_virtual
  - action_cuadernillo_predial
  - action_cuadernillo_vehicular
  - action_declaracion_impuesto_vehicular
  - action_liquidacion_alcabala
  - action_declaracion_impuesto_predial
  - action_fraccionar_deuda
  - action_beneficios_pensionista
  - action_beneficios_adulto_mayor
  - action_route_document_consultation
  # ========== RETENCIÓN ACTIONS ==========
  - action_consultar_orden_captura
  - action_retencion_embargo
  - action_retencion_vehiculo_internado
  - action_retencion_suspender_cobranza
  - action_retencion_terceria_propiedad
  - action_retencion_levantamiento
  - action_retencion_remate_vehicular
  # ========== ACTUALIZAR DATOS ACTIONS ==========
  - action_actualizar_datos
  # ========== LUGARES Y PAGOS ACTIONS ==========
  - action_lugares_agencias_horarios
  - action_lugares_pago
  - action_lugares_formas_pago
  # ========== SERVICIOS VIRTUALES ACTIONS ==========
  - action_servicios_mesa_partes
  - action_servicios_agencia_virtual
  - action_servicios_pitazo
  - action_servicios_correo
  - action_servicios_libro_reclamaciones
  - action_servicios_cursos
  # ========== OTROS TRÁMITES ACTIONS ==========
  - utter_otros_tramites_menu
  - utter_tramites_requisitos_papeletas
  - utter_tramites_requisitos_tributarios
  - action_consultar_tramite
  - action_tramites_impugnacion_papeletas
  - action_tramites_reclamo_tributario
  - action_tramites_constancias_no_adeudo
  # ========== TRÁMITES PAPELETAS ESPECÍFICOS ==========
  - action_tramites_recurso_reconsideracion
  - action_tramites_descarga_infracciones
  - action_tramites_apelacion_papeletas
  - action_tramites_prescripcion_papeletas
  - action_tramites_devolucion_papeletas
  - action_tramites_terceria_requisitos
  - action_tramites_suspension_requisitos
  # ========== TRÁMITES TRIBUTARIOS ESPECÍFICOS ==========
  - action_tramites_predial_requisitos
  - action_tramites_vehicular_requisitos
  - action_tramites_alcabala_requisitos
  - action_tramites_reclamacion_tributaria
  - action_tramites_prescripcion_tributaria
  - action_tramites_devolucion_tributaria
  - action_tramites_apelacion_tributaria
  - action_tramites_terceria_tributaria
  - action_tramites_suspension_tributaria
  # ========== FINALIZAR CHAT ==========
  - action_finalizar_chat

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: false